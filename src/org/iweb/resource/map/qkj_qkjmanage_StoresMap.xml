<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "sql-map-2.dtd">
<sqlMap>
	<!-- Product Start -->
	<typeAlias alias="StoresOrder" type="com.qkj.manage.domain.StoresOrder" />
	<typeAlias alias="product" type="com.qkj.manage.domain.Product" />
		<select id="qkjStores_getProducts" resultClass="product" parameterClass="java.util.Map">
		<![CDATA[ 
			select * from qkj_t_product p
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="code"><![CDATA[ p.bar_code=#code# ]]></isNotEmpty>
		</dynamic>
	</select>

		 <insert  id ="qkjStores_addProducts"  parameterClass ="java.util.List" >  
    <![CDATA[
        insert into qkj_t_order_item(bar_code,order_id,prod_code,product_price,spec,title,order_total_price,order_num,product_id) values  
    ]]>
   <iterate conjunction=",">
        <![CDATA[(#parameters[].bar_code#,#parameters[].order_id#,#parameters[].prod_code#,#parameters[].product_price#,#parameters[].spec#,#parameters[].title#,#parameters[].order_total_price#,#parameters[].order_num#,#parameters[].product_id#)  
        ]]>
    </iterate>
</insert >


	 <insert  id ="qkjStores_addOrder"  parameterClass ="StoresOrder" >  
    <![CDATA[
        insert into qkj_t_order(user_id,user_name,total_price,add_time) values 
        (#user_id#,#user_name#,#total_price#,#add_time#)  
    ]]>
     <selectKey resultClass="int" type="post" keyProperty="id" >     
        select @@IDENTITY as value     
    </selectKey>
</insert >
	<!-- Product End -->
</sqlMap>